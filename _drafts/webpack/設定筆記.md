# Webpack4 筆記(一)

## 基礎設定

---

### 建立專案

在該專案的資料夾內部建立 npm 專案

```
npm init -f
```

資料夾內會多出`package.json`的檔案

### 安裝 webpack

```
npm install webpack webpack-cli --save-dev
```

### 設定 webpack

在專案資料夾中新增 `webpack.config.js` 檔案

```js
const path = require('path') //(2)
module.exports = {
  context: path.resolve(__dirname, 'src'), //(3)
  entry: './index.js', //(4)
  output: {
    path: path.resolve(__dirname, './'), //(5)
    filename: 'index.bundle.js' //(6)
  }
}
```

1. webpack 是建立在 nodejs 上面的工具，webpack 只負責編譯，搬檔案就要靠 nodejs 的 api 來幫忙
2. node.js 搬移檔案靠一個叫`path`的 API 來做，用`require`引入 path 模組
3. `__dirname`在 nodejs 裡面代表的一個特殊的變數，指的是當前執行文件所在目錄的完整目錄位置
4. `entry`指定要編譯的檔案，多筆資料可以用陣列表示`['./index.js' , './app.js']`
5. 輸出檔案位置(如果沒有寫預設會輸出在 dist 的資料夾裡)
6. 輸出檔案名稱，多筆資料輸出可使用變數`'[name].bundle.js'`，讓他自動幫你匹配輸入的檔案名稱

### 定義 npm 指令

在 `package.json` 找到 `scripts` 區塊，新增指令

```json
{
  "scripts": {
    "watch": "webpack --mode development --watch", //(2)
    "start": "webpack --mode development", //(1.1)
    "deploy": "webpack --mode production" // (1.2)
  }
}
```

1. `--mode`
   1.1 `development` 開發中，只編譯
   1.2 `production` 上線版本，將檔案給壓縮跟優化(webpack4 預設是 production)
2. webpack 執行一次性編譯 ，如果需要持續監聽，加上 `--watch`

### 執行一次性編譯

```
npm run start
```

![npm run start](/assets/themes/susan/images/webpack_test_01.jpg)

### 執行監聽

```
npm run watch
```

![npm run start](/assets/themes/susan/images/webpack_test_02.jpg)

### 停止監聽

```
Ctrl + C
```

## Babel

---

### 安裝 Babel

```
npm install babel-loader @babel/core @babel/preset-env --save-dev
```

`babel-loader` 讀取檔案格式
`@babel/core` babel 的核心，主要負責解析並產出新的原始碼
`@babel/preset-env` 有點像是規則書，裏面包含了 ES5、ES6、ES7 的邏輯，幫助你將語法轉成 ES5

### 設定 Babel

編輯`webpack.config.js` 新增 `module`

```json
{
  "module": {
    "rules": [
      {
        "test": /\.(js)$/,
        "exclude": /(node_modules)/,
        "use": {
          "loader": "babel-loader",
          "options": {
            "presets": ["@babel/preset-env"]
          }
        }
      }
    ]
  }
}
```

## CSS

---

### 安裝 CSS

```
npm install css-loader style-loader --save-dev
```

`css-loader` 讓你寫的 CSS 可以載入到 js 裡
`style-loader` 將處理好的 css 套用到頁面上

在 js 引入 CSS

```js
import '../css/styke.css'
```

### 設定 CSS

編輯 `webpack.config.js` ,在 `module > rules` 新增 CSS 設定

```json
{
  "module": {
    "rules": [
      {
        "test": /\.css$/,
        "use": [
          //註(1)
          "style-loader",
          "css-loader"
        ]
      }
    ]
  }
}
```

> 註(1)
> **webpack 會反向執行**，依據上面執行解析大概的意思是：當要載入.css 檔案時，先用 css-loader 解析，再用 style-loader 將 CSS 加入到頁面中，順序要注意是否正確!!

編譯後，會發現 CSS 全部塞到 Head 裡面了，可是這不是我要的，我希望 css 另外獨立出來一個檔案引入，可以使用 `mini-css-extract-plugin`

題外話：
第一次練習的時候，很多網站推薦使用 `extract-text-webpack-plugin`
使用後卻會跳出 npm ERR!
經查詢後發現
`extract-text-webpack-plugin` 已被棄用!!
`extract-text-webpack-plugin` 已被棄用!!
`extract-text-webpack-plugin` 已被棄用!!

![extract-text-webpack-plugin](/assets/themes/susan/images/webpack_test_03.jpg)

## SASS/SCSS

---

裝載

```
npm install sass-loader node-sass extract-text-webpack-plugin --save-dev
```

`sass-loader` 讓 sass/scss 編譯成 css
`node-sass` 相依姓問題
`extract-text-webpack-plugin` 將編譯過的 css 另存起來

## 資料來源

---

[Webpack 教學 (一) ：什麼是 Webpack? 能吃嗎？](https://medium.com/@Mike_Cheng1208/%E4%BB%80%E9%BA%BC%E6%98%AFwebpack-%E4%BD%A0%E9%9C%80%E8%A6%81webpack%E5%97%8E-2d8f9658241d)
[Webpack 教學 (二) ：檔案你要去哪裡？](https://medium.com/@Mike_Cheng1208/webpack%E6%95%99%E5%AD%B8-%E4%BA%8C-%E6%AA%94%E6%A1%88%E4%BD%A0%E8%A6%81%E5%8E%BB%E5%93%AA%E8%A3%A1-13bdada9e543)
[使用 webpack.config.js 來設定 webpack !](https://ithelp.ithome.com.tw/articles/10193343)
[Webpack 實作入門 2：打包 CSS / SCSS 與 加入 Bootstrap](http://www.mrmu.com.tw/2017/08/18/webpack-tutorial2-css-scss/)
